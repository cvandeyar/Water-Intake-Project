{% extends 'base.html' %}
{% block content %}


<div class="row">
    <div class="col">
        <div>
            Today's Date: {{ current_date }} <br>
            Timezone: {{ time_zone }} DELETE LATER!!!!!
        </div>

        <div>
            <h2>Hi, {{ fname }}!</h2>
            Hope you're keeping hydrated!üòÅ
        </div>
        <div id='goal_num'>
            Daily Goal: {{ user_goal_oz }} Oz (About {{ user_goal_cups }} Cups)
        </div>
    </div>
</div>



<br>


<div class="row">
    <div class="col">
        <div>
            Water Intake...
        </div>

        <form id="add-water">
            <div>
                <select id='qty-field' name='drink' required>
                    <option disabled selected value> -- select an option -- </option>
                    <option value='2'> 2 Oz (1/4 Cup)</option>
                    <option value='4'> 4 Oz (1/2 Cup)</option>
                    <option value='6'> 6 Oz (3/4 Cup)</option>
                    <option value='8'> 8 Oz (1 Cup)</option>
                    <option value='12'> 12 Oz (1.5 Cups)</option>
                    <option value='16'> 16 Oz (2 Cups)</option>
                </select>
            </div>

            <div>
                 <input id='submit_water' type="submit" value="SUBMIT">
            </div>
        </form>  

        
        <div id='daily_goal'>
            Current Water Count: {{ total_water_today }} Oz ( {{ total_cups_today }} Cups)
        </div>

<script src="/static/js/daily_goal.js"></script>


 <!-- add motivational messages when getting close to goal or goal is met -->


        

<!-- want to give msg that they're getting close or met their goal -->

        

    </div>
</div>

<br>
<div class='row'>
    <div class='col'>
        <form id='stat-submit'>
            <div>
                <select id='stats' name='filter_name' required>
                    <option value='days'>View Stats</option>
                    <!-- <option value='today'> Today </option> -->
                    <option value='days'> View by days </option>
                    <option value='weeks'> View by Week </option>
                    <option value='months'> View by Month </option>
                </select>
            </div>
            <div>
                <input type="submit" value='Stats'>
            </div>
        </form>
    </div>
</div>


<canvas id="myChart" width="400" height="400"></canvas>

<!-- <script>
    const time_parameter = {{ time_parameter|tojson }}
    const qty = {{ qty|tojson }}
    const user_goal_oz = {{ user_goal_oz }}
</script> -->

<script src="/static/js/stat_page.js"></script>

<!-- <script>
    "use strict";
    let ctx = document.getElementById("myChart").getContext('2d');
    let myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ time_parameter|tojson }}, 
            datasets: [{
            label: "Daily Water Intake",
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 1)',
            data: {{ qty|tojson }} 
        }],
    },
        options: {
            scales: {
                xAxes: [{
                    stacked: true
                }],
                yAxes: [{
                    stacked: true
                }]
            }
            ,

            animation: {
            duration: 0, // general animation time
        },
        hover: {
            animationDuration: 0, // duration of animations when hovering an item
        },
        responsiveAnimationDuration: 0, // animation duration after a resize

    }

    });
</script> -->





<!-- <script>
    "use strict";
    let ctx = document.getElementById("myChart").getContext('2d');
    let myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ time_parameter|tojson }}, 
            datasets: [{
            label: "Daily Water Intake",
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            data: {{ qty|tojson }} 
        }],
    },
        options: {
            scales: {
                xAxes: [{
                    stacked: true
                }],
                yAxes: [{
                    stacked: true
                }]
            }
        //     ,

        //     animation: {
        //     duration: 0, // general animation time
        // },
        // hover: {
        //     animationDuration: 0, // duration of animations when hovering an item
        // },
        // responsiveAnimationDuration: 0, // animation duration after a resize

    }

    });
</script> -->


<!-- <script>
    "use strict";
    let ctx = document.getElementById("myChart").getContext('2d');
    let myChart = new Chart(ctx, {
            type: 'horizontalBar',
            data: {
                datasets: [{
                    label: 'qty',
                    data: {{ qty|tojson }},
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255,99,132,1)',
                },
                {
                    label: 'goal',

            data: Array.apply(null, new Array(5)).map(Number.prototype.valueOf, {{ user_goal_oz }}),
            fill: false,
            radius: 0,
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 1)',
                }],
            labels: {{ time_parameter|tojson }}
        },


       

        // options: {
        //     scales: {
        //         xAxes: [{
        //             stacked: true
        //         }],
        //         yAxes: [{
        //             stacked: true
        //         }]
        //     }}

        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero:true
                    },
                    scaleLabel: {
                         display: true,
                         labelString: 'Qty',
                         fontSize: 20 
                  }
            }]            
        }  
}


    });




</script> -->




<!-- <script>
    "use strict";
    let ctx = document.getElementById("myChart").getContext('2d');
    let myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                datasets: [{
                    label: 'qty',
                    data: {{ qty|tojson }},
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255,99,132,1)',
                },
                {
                    label: 'goal',
                    data: Array.apply(null, new Array(-100, 0, 100)).map(Number.prototype.valueOf, {{ user_goal_oz }}),
                    type: 'line',
                    fill: false,
                    radius: 10,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                }],
            labels: {{ time_parameter|tojson }}
        },


       

        options: {
            scales: {
                xAxes: [{
                    stacked: true
                }],
                yAxes: [{
                    stacked: true
                }]
            }}


    });

</script> -->






<!-- this is for grabbing the city every time you submit a drink -->
<!-- <script>
    

    // fetch("https://ipinfo.io/json?token={{ IP_token }}").then(function(response){
    //     response.json().then((data)=>{
    //         console.log(data)
    //     })
    // })
    
    
    // const getIPInfo = async () => {
    //     const response = await fetch("https://ipinfo.io/json?token={{ IP_token }}")
    //     const data = await response.json()
    //     console.log(data, data['city'])
    // }
    // getIPInfo();
    
    
    // const getIPInfo = async () => {
    //     const response = await fetch("https://ipinfo.io/json?token={{ IP_token }}")
    //     const data = await response.json()
    //     return data['city'];
    // }
    // getIPInfo().then((city) => console.log(city));
    

    const getIPInfo = async () => {
        const response = await fetch("https://ipinfo.io/json?token={{ IP_token }}")
        const data = await response.json()
        return data;
    }
    // getIPInfo().then((city) => console.log(city));

    function rerouteBack(response){
        console.log(response)
        window.location.reload();
    }

    async function submitWater(evt) {
        evt.preventDefault();
        const data = await getIPInfo();

        var formInputs = {
            "drink": ($("#qty-field").val()),
            "postal": data['postal'],
        };

        $.post("/add-water", 
           formInputs,
           rerouteBack);
    };

    $("#add-water").on("submit", submitWater);


</script> -->





<div>
    <form action='/logout'>
        <div>
            <input type="submit" value="LOGOUT">
        </div>
    </form>
</div>



{% endblock %}